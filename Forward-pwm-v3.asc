Version 4
SHEET 1 4964 2228
WIRE -64 -144 -656 -144
WIRE 208 -144 -64 -144
WIRE -64 -64 -64 -144
WIRE 208 -64 208 -144
WIRE -656 -48 -656 -144
WIRE -656 -48 -800 -48
WIRE -576 -48 -656 -48
WIRE -512 -48 -576 -48
WIRE -656 -32 -656 -48
WIRE -800 0 -800 -48
WIRE -512 0 -512 -48
WIRE -208 16 -304 16
WIRE -112 16 -160 16
WIRE 2288 16 2224 16
WIRE 2400 16 2352 16
WIRE 2528 16 2464 16
WIRE 2656 16 2592 16
WIRE -656 48 -656 32
WIRE -208 48 -208 16
WIRE -160 48 -160 16
WIRE -64 80 -64 32
WIRE 288 80 -64 80
WIRE 384 80 288 80
WIRE 608 80 496 80
WIRE 752 80 672 80
WIRE 816 80 752 80
WIRE 976 80 896 80
WIRE 1312 80 976 80
WIRE 1472 80 1312 80
WIRE 1808 80 1472 80
WIRE 2000 80 1888 80
WIRE 2224 80 2224 16
WIRE 2224 80 2080 80
WIRE 2400 80 2400 16
WIRE 2464 80 2464 16
WIRE 2464 80 2400 80
WIRE 2656 80 2656 16
WIRE 2752 80 2656 80
WIRE 2800 80 2752 80
WIRE 3104 80 3008 80
WIRE 3216 80 3104 80
WIRE 3424 80 3216 80
WIRE 288 112 288 80
WIRE 384 112 384 80
WIRE 496 112 496 80
WIRE 752 112 752 80
WIRE 976 112 976 80
WIRE -800 128 -800 64
WIRE -752 128 -800 128
WIRE -640 128 -672 128
WIRE -512 128 -512 64
WIRE -512 128 -560 128
WIRE 2224 128 2224 80
WIRE 2272 128 2224 128
WIRE 2400 128 2400 80
WIRE 2400 128 2352 128
WIRE 2464 128 2464 80
WIRE 2512 128 2464 128
WIRE 2656 128 2656 80
WIRE 2656 128 2592 128
WIRE -208 160 -208 128
WIRE -160 160 -160 128
WIRE -64 160 -64 80
WIRE -64 160 -160 160
WIRE -800 192 -800 128
WIRE -512 192 -512 128
WIRE 3008 192 3008 80
WIRE 3216 192 3216 80
WIRE 2800 208 2800 80
WIRE 3424 208 3424 80
WIRE 208 224 208 0
WIRE 288 224 288 192
WIRE 288 224 208 224
WIRE 384 224 384 192
WIRE 384 224 288 224
WIRE 496 240 496 192
WIRE 752 240 752 176
WIRE 976 240 976 176
WIRE -64 256 -64 160
WIRE 48 256 16 256
WIRE 144 256 128 256
WIRE 208 256 208 224
WIRE -800 272 -800 256
WIRE -656 272 -800 272
WIRE -512 272 -512 256
WIRE -512 272 -656 272
WIRE -656 288 -656 272
WIRE 16 320 16 256
WIRE 32 320 16 320
WIRE 144 336 144 256
WIRE 144 336 96 336
WIRE 160 336 144 336
WIRE 32 352 16 352
WIRE -608 368 -736 368
WIRE 2272 368 1536 368
WIRE 2800 368 2800 288
WIRE 2800 368 2352 368
WIRE 3008 368 3008 272
WIRE 3216 368 3216 272
WIRE 3216 368 3008 368
WIRE 3424 368 3424 272
WIRE 3424 368 3216 368
WIRE 3424 400 3424 368
WIRE -736 416 -736 368
WIRE -720 416 -736 416
WIRE -64 416 -64 320
WIRE 208 416 208 352
WIRE -608 432 -608 368
WIRE -608 432 -656 432
WIRE -304 432 -304 16
WIRE -304 432 -608 432
WIRE -880 448 -944 448
WIRE -752 448 -880 448
WIRE -720 448 -752 448
WIRE 16 464 16 352
WIRE 16 464 -608 464
WIRE -752 480 -752 448
WIRE -608 480 -608 464
WIRE -608 480 -752 480
WIRE 288 544 256 544
WIRE 384 544 368 544
WIRE -496 656 -496 640
WIRE 384 656 384 544
WIRE 384 656 368 656
WIRE 432 656 384 656
WIRE 560 656 512 656
WIRE -192 672 -208 672
WIRE -96 672 -112 672
WIRE -32 672 -48 672
WIRE 256 672 256 544
WIRE 256 672 48 672
WIRE 304 672 256 672
WIRE 1312 672 1312 80
WIRE 400 688 368 688
WIRE 848 688 768 688
WIRE 960 688 928 688
WIRE -720 704 -720 688
WIRE -624 704 -624 688
WIRE 400 704 400 688
WIRE -512 768 -544 768
WIRE -496 768 -496 736
WIRE -496 768 -512 768
WIRE 1536 768 1536 368
WIRE 1680 768 1536 768
WIRE -944 784 -944 448
WIRE -800 784 -944 784
WIRE -96 784 -96 672
WIRE -96 784 -112 784
WIRE -48 784 -48 672
WIRE -48 784 -96 784
WIRE 960 784 960 688
WIRE 960 784 864 784
WIRE 992 784 960 784
WIRE 1136 784 1072 784
WIRE 1216 784 1136 784
WIRE 1312 784 1312 752
WIRE 1408 784 1312 784
WIRE -336 800 -544 800
WIRE -208 800 -208 672
WIRE -208 800 -336 800
WIRE -176 800 -208 800
WIRE 560 800 560 656
WIRE 688 800 560 800
WIRE 768 800 768 688
WIRE 768 800 688 800
WIRE 800 800 768 800
WIRE 1312 800 1312 784
WIRE -80 816 -112 816
WIRE 400 816 400 800
WIRE 400 816 368 816
WIRE 896 816 864 816
WIRE 960 816 896 816
WIRE 1536 816 1536 768
WIRE -80 832 -80 816
WIRE -48 832 -48 784
WIRE -32 832 -48 832
WIRE 176 832 48 832
WIRE 256 832 176 832
WIRE 304 832 256 832
WIRE 384 848 368 848
WIRE 432 848 384 848
WIRE 560 848 560 800
WIRE 560 848 512 848
WIRE 896 848 896 816
WIRE 960 848 960 816
WIRE 1312 848 1312 800
WIRE 1536 848 1536 816
WIRE 1824 880 1792 880
WIRE 1920 880 1904 880
WIRE 2112 896 2080 896
WIRE 2208 896 2192 896
WIRE 960 944 960 928
WIRE 1312 944 1312 928
WIRE 1536 944 1536 928
WIRE 256 960 256 832
WIRE 304 960 256 960
WIRE 384 960 384 848
WIRE 384 960 368 960
WIRE 960 960 960 944
WIRE 1680 960 1680 768
WIRE 1696 960 1680 960
WIRE 1792 960 1792 880
WIRE 1792 960 1776 960
WIRE 1824 960 1792 960
WIRE 1920 976 1920 880
WIRE 1920 976 1888 976
WIRE 1952 976 1920 976
WIRE 1984 976 1952 976
WIRE 2080 976 2080 896
WIRE 2080 976 2064 976
WIRE 2112 976 2080 976
WIRE 1824 992 1792 992
WIRE 2208 992 2208 896
WIRE 2208 992 2176 992
WIRE 2256 992 2208 992
WIRE 2112 1008 2080 1008
WIRE 2544 1008 2544 992
WIRE 1792 1024 1792 992
WIRE 896 1040 896 928
WIRE 2080 1040 2080 1008
WIRE 3312 1040 3312 1024
WIRE 2256 1072 2256 992
WIRE 2448 1072 2256 1072
WIRE 2688 1104 2640 1104
WIRE 3216 1104 2688 1104
WIRE 2112 1136 2080 1136
WIRE 2208 1136 2192 1136
WIRE 2448 1136 2256 1136
WIRE 3440 1136 3408 1136
WIRE 3216 1168 3056 1168
WIRE 2448 1200 2304 1200
WIRE 1952 1216 1952 976
WIRE 1984 1216 1952 1216
WIRE 2080 1216 2080 1136
WIRE 2080 1216 2064 1216
WIRE 2112 1216 2080 1216
WIRE 2208 1232 2208 1136
WIRE 2208 1232 2176 1232
WIRE 2256 1232 2256 1136
WIRE 2256 1232 2208 1232
WIRE 3216 1232 3088 1232
WIRE 2112 1248 2080 1248
WIRE 2448 1248 2384 1248
WIRE 1584 1280 1456 1280
WIRE 2080 1280 2080 1248
WIRE 3216 1280 3168 1280
WIRE 1456 1344 1456 1280
WIRE 1472 1344 1456 1344
WIRE 1584 1360 1584 1280
WIRE 1584 1360 1536 1360
WIRE 1968 1360 1584 1360
WIRE 2656 1360 1968 1360
WIRE 3056 1360 3056 1168
WIRE 3056 1360 2656 1360
WIRE 1408 1376 1408 784
WIRE 1472 1376 1408 1376
WIRE 2096 1504 2096 1488
WIRE 2192 1504 2192 1488
WIRE 2832 1504 2832 1488
WIRE 2928 1504 2928 1488
WIRE 1968 1568 1968 1360
WIRE 2016 1568 1968 1568
WIRE 2688 1568 2688 1104
WIRE 2752 1568 2688 1568
WIRE 2304 1584 2304 1200
WIRE 2304 1584 2272 1584
WIRE 3088 1584 3088 1232
WIRE 3088 1584 3008 1584
WIRE 2016 1600 1952 1600
WIRE 2656 1600 2656 1360
WIRE 2752 1600 2656 1600
WIRE 1216 1856 1216 784
WIRE 3440 1856 3440 1136
WIRE 3440 1856 1216 1856
FLAG 496 240 0
FLAG 752 240 0
FLAG 976 240 0
FLAG 208 416 0
FLAG -64 416 0
FLAG -656 288 0
FLAG -656 48 0
FLAG 1312 944 0
FLAG 960 1040 0
FLAG -496 640 0
FLAG 688 800 error
FLAG -80 832 0
FLAG 400 704 0
FLAG 400 800 0
FLAG 176 832 int_out
FLAG 1472 80 bat
FLAG -336 800 control
FLAG -128 1072 0
FLAG -64 1072 0
FLAG -128 992 +3V
FLAG -64 992 -3V
FLAG 896 1040 0
FLAG -576 -48 in
FLAG 1536 944 0
FLAG 1312 800 V_fb
FLAG 1536 816 I_fb
FLAG -512 768 st
FLAG 960 944 ref
FLAG 1136 784 sense
FLAG 2080 1280 0
FLAG 2080 1040 0
FLAG 2544 912 0
FLAG 2608 1312 0
FLAG 2384 1328 0
FLAG 3312 944 0
FLAG 3376 1344 0
FLAG 3168 1360 0
FLAG 1872 1600 0
FLAG 3248 1344 0
FLAG 2480 1312 0
FLAG 2928 1408 0
FLAG 2832 1408 0
FLAG 2928 1728 0
FLAG 2192 1408 0
FLAG 2096 1408 0
FLAG -720 608 0
FLAG -624 608 0
FLAG -720 928 0
FLAG 3424 400 0
FLAG 3104 80 vsoc
FLAG 2752 80 batt
FLAG 336 864 +3V
FLAG 336 640 +3V
FLAG 336 800 -3V
FLAG 336 704 -3V
FLAG -144 832 -3V
FLAG -144 768 +3V
FLAG 2192 1728 0
FLAG -208 160 0
FLAG 16 176 0
FLAG -880 448 pwm
FLAG 1792 1024 0
FLAG 832 768 +3V
FLAG 832 832 -3V
SYMBOL ind2 368 96 R0
SYMATTR InstName L1
SYMATTR Value 300µ
SYMATTR Type ind
SYMBOL ind2 480 96 R0
SYMATTR InstName L2
SYMATTR Value 300µ
SYMATTR Type ind
SYMBOL ind 800 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName Lx
SYMATTR Value 400µ
SYMATTR SpiceLine Rser=20m
SYMBOL cap 960 112 R0
SYMATTR InstName Cx
SYMATTR Value 200µ
SYMATTR SpiceLine Rser=10m
SYMBOL nmos 160 256 R0
SYMATTR InstName M2
SYMATTR Value AOD280A60
SYMBOL diode -48 320 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 224 0 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode 608 96 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL diode 768 176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL nmos -112 -64 R0
SYMATTR InstName M1
SYMATTR Value AOD280A60
SYMBOL ind 272 96 R0
SYMATTR InstName L3
SYMATTR Value 5m
SYMBOL voltage -656 128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vac
SYMATTR Value SINE(0 {Vac*sqrt(2)} 50)
SYMBOL cap -672 -32 R0
SYMATTR InstName C2
SYMATTR Value 50µ
SYMBOL diode -784 256 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL diode -528 256 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL diode -784 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMBOL diode -528 64 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMBOL res 1296 656 R0
SYMATTR InstName Rdivh
SYMATTR Value 11.6k
SYMBOL res 1296 832 R0
SYMATTR InstName Rdivl
SYMATTR Value 1k
SYMBOL res 1088 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL voltage 960 944 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 1
SYMBOL res 944 832 R0
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL res 944 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL voltage -496 752 M180
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 {Vst} 0 {0.99/fsw} {0.01/fsw} 0 {1/fsw})
SYMATTR InstName V2
SYMBOL res -96 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL res 528 640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rp1
SYMATTR Value 1k
SYMBOL res 384 528 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rp2
SYMATTR Value 2k
SYMBOL res 528 864 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName Ri
SYMATTR Value 1k
SYMBOL cap 368 976 M270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName Ci
SYMATTR Value 0.5µ
SYMBOL res 64 848 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R14
SYMATTR Value 100k
SYMBOL res 64 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 100k
SYMBOL OpAmps\\UniversalOpAmp2 336 672 M0
SYMATTR InstName U3
SYMBOL OpAmps\\UniversalOpAmp2 336 832 R180
SYMATTR InstName U4
SYMBOL voltage -128 976 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value {Vst/2}
SYMBOL voltage -64 1088 M180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value {Vst/2}
SYMBOL OpAmps\\UniversalOpAmp2 -144 800 M0
SYMATTR InstName U2
SYMBOL voltage -768 128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vpert
SYMATTR Value PULSE(0 0 3m 1n 1n 5m 20m)
SYMBOL res 912 832 M0
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res 1552 832 M0
SYMATTR InstName R_I_fb
SYMATTR Value 0.15
SYMBOL OpAmps\\UniversalOpAmp1 2144 1232 R0
SYMATTR InstName U5
SYMBOL res 2096 1120 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R2
SYMATTR Value 100k
SYMBOL res 1968 1200 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 20k
SYMBOL OpAmps\\UniversalOpAmp1 2144 992 R0
SYMATTR InstName U6
SYMBOL res 2096 880 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 100k
SYMBOL res 1968 960 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL Switches\\ADG5419 2544 1152 R0
SYMATTR InstName U8
SYMBOL voltage 2544 1008 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V6
SYMATTR Value 30
SYMBOL voltage 2384 1232 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V7
SYMATTR Value 5
SYMBOL Switches\\ADG5419 3312 1184 R0
SYMATTR InstName U9
SYMBOL voltage 3312 1040 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V8
SYMATTR Value 15
SYMBOL voltage 3168 1264 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V9
SYMATTR Value 5
SYMBOL voltage 1968 1600 R90
WINDOW 0 49 8 VRight 2
WINDOW 3 49 67 VRight 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V12
SYMATTR Value {30/42}
SYMBOL Comparators\\LTC6752-2 2880 1616 R0
SYMATTR InstName U12
SYMBOL voltage 2928 1504 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V10
SYMATTR Value 5
SYMBOL voltage 2832 1504 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V11
SYMATTR Value 5
SYMBOL Comparators\\LTC6752-2 2144 1616 R0
SYMATTR InstName U11
SYMBOL voltage 2192 1504 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V13
SYMATTR Value 5
SYMBOL voltage 2096 1504 R180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V14
SYMATTR Value 5
SYMBOL OpAmps\\UniversalOpAmp 1504 1360 R0
SYMATTR InstName U13
SYMBOL Comparators\\LTC6752-2 -672 816 M0
SYMATTR InstName U14
SYMBOL voltage -720 704 M180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value 5
SYMBOL voltage -624 704 M180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V15
SYMATTR Value 5
SYMBOL res 2496 112 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R1
SYMATTR Value 0.1
SYMBOL res 2256 112 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R11
SYMATTR Value 1
SYMBOL res 1984 64 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R13
SYMATTR Value 0.2
SYMBOL cap 2528 0 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C1
SYMATTR Value 1000p
SYMBOL cap 2288 0 M90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 10µ
SYMBOL res 3232 176 M0
SYMATTR InstName R15
SYMATTR Value 10k
SYMBOL cap 3440 208 M0
SYMATTR InstName C4
SYMATTR Value 40m
SYMBOL bi 3008 192 M0
SYMATTR InstName B1
SYMATTR Value I=I(Rsense)
SYMBOL res 2256 352 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rsense
SYMATTR Value 1m
SYMBOL bv 2800 192 M0
WINDOW 3 58 70 Left 1
SYMATTR Value V=12.6*((-8.0128*pwr(V(vsoc),5) + 22.509*pwr(V(vsoc),4) - 19.929*pwr(V(vsoc),3) + 4.332*pwr(V(vsoc),2) + 2.0965*V(vsoc) + 0.0026))
SYMATTR InstName bat
SYMBOL ind 1904 96 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L4
SYMATTR Value 1µ
SYMBOL OpAmps\\UniversalOpAmp2 832 800 M0
SYMATTR InstName U1
SYMBOL ind2 -192 32 M0
SYMATTR InstName L5
SYMATTR Value 10µ
SYMATTR Type ind
SYMATTR SpiceLine Rser=5m
SYMBOL ind2 -176 32 R0
SYMATTR InstName L6
SYMATTR Value 100µ
SYMATTR Type ind
SYMATTR SpiceLine Rser=5m
SYMBOL OpAmps\\UniversalOpAmp1 64 336 R0
SYMATTR InstName U7
SYMBOL res 32 272 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R16
SYMATTR Value 1k
SYMBOL res 144 240 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R17
SYMATTR Value 1k
SYMBOL OpAmps\\UniversalOpAmp1 -688 432 R0
SYMATTR InstName U15
SYMBOL OpAmps\\UniversalOpAmp1 1856 976 R0
SYMATTR InstName Uc
SYMBOL res 1808 864 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rgain
SYMATTR Value 41.9k
SYMBOL res 1680 944 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R29
SYMATTR Value 10k
TEXT 392 56 Left 2 !K L1 L2 1
TEXT -1544 272 Left 2 !.tran 100m
TEXT -1544 296 Left 2 !.param Vac=36 fsw=125k Vsw=12 Vst=6 SOC=0.1
TEXT -176 592 Left 2 ;Sumador/Inversor
TEXT 416 568 Left 2 ;Proporcional
TEXT 408 944 Left 2 ;Integrador
TEXT -1544 320 Left 2 !.ic V(error)=0
TEXT -1544 344 Left 2 !.model SW SW(Ron=1e-3 Roff=10Meg Vt=0.5)
TEXT -896 -264 Left 2 ;Conversion AC/DC no regulada:\nRectificador de onda completa tipo\npuente con filtro de capacitor
TEXT 0 -208 Left 2 ;Conversor Forward de doble switch (DC/DC) con driver PWM
TEXT 1320 560 Left 2 ;Sensado de\ntensión y corriente
TEXT 800 608 Left 2 ;Amplificador de error
TEXT 80 1120 Left 2 ;Compensación
TEXT -784 552 Left 2 ;Generador de onda PWM
TEXT -1544 96 Left 2 !.options gmin=1e-9\n.options abstol=1e-9\n.options reltol=0.003\n.options cshunt=1e-15
TEXT 1752 784 Left 1 ;Valores de modulo de ganancia Uc según el modo\n1A -> 6.7\n1.6A -> 4.19
TEXT 3464 296 VLeft 2 ;Capacidad\n11.11uAh
TEXT 4336 -88 Right 2 ;Constantes de tiempo corta y larga de la respuesta transitoria, caida de tensión instantanea, inductancia de los cables
TEXT 2776 320 Right 2 ;Voc
TEXT 3128 40 Right 2 !.ic V(vsoc)=0.3518
TEXT 3584 120 Left 2 ;vsoc ic -> 1V = 100% SOC, 0V = 0% SOC\n1A=1C/s\nQ=C x V\n3.6Ah = 3.6C/s x 1h = 3600s/h x 3.6C/s x 1h = 12960C = 12960F x 1V\nLa capacidad se reduce para simular el ciclo de carga en menos tiempo\n1V x 40mF = 40mC = 40mA/s x 1h/3600s = 11.11uAh
TEXT 3256 304 VLeft 2 ;Rselfdischarge
TEXT 1680 1288 Left 2 ;CC/Precarga
TEXT 1808 1808 Left 2 ;Comparador Precarga/CC
TEXT 2632 1808 Left 2 ;Comparador CC/CV
TEXT 2664 1056 Left 2 ;Multiplexor Precarga/CC
TEXT 3424 1104 Left 2 ;Multiplexor CC/CV
TEXT 1376 632 Left 2 !.ic V(I_fb)=0
TEXT 3864 504 Left 2 ;Modelo de bateria
TEXT 3368 296 Left 2 ;40m
TEXT -120 0 Right 2 !K2 L5 L6 1
TEXT -888 336 Left 2 ;Vpert sirve para simular bajas o altas tensiones
RECTANGLE Normal 1600 976 1248 608 2
RECTANGLE Normal 1088 1072 736 624 2
RECTANGLE Normal 624 1104 -256 496 2
RECTANGLE Normal 2272 1312 1664 560 2
RECTANGLE Normal 2352 1824 1792 1376 2
RECTANGLE Normal 3120 1824 2624 1376 2
RECTANGLE Normal -880 976 -416 576 2
RECTANGLE Normal 4432 -128 1664 528 2
RECTANGLE Normal -416 352 -896 -192 2
RECTANGLE Normal 1088 480 -352 -192 2
