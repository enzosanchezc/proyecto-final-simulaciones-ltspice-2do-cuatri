Version 4
SHEET 1 2636 1364
WIRE -384 -144 -656 -144
WIRE -80 -144 -384 -144
WIRE 208 -144 -80 -144
WIRE -80 -64 -80 -144
WIRE 208 -64 208 -144
WIRE -656 -48 -656 -144
WIRE -656 -48 -800 -48
WIRE -576 -48 -656 -48
WIRE -512 -48 -576 -48
WIRE -800 0 -800 -48
WIRE -512 0 -512 -48
WIRE -128 16 -160 16
WIRE -80 80 -80 32
WIRE 288 80 -80 80
WIRE 384 80 288 80
WIRE 608 80 496 80
WIRE 752 80 672 80
WIRE 816 80 752 80
WIRE 976 80 896 80
WIRE 1312 80 976 80
WIRE 1472 80 1312 80
WIRE 1536 80 1472 80
WIRE 2224 80 1536 80
WIRE -384 96 -384 -144
WIRE -80 96 -80 80
WIRE -80 96 -160 96
WIRE 288 112 288 80
WIRE 384 112 384 80
WIRE 496 112 496 80
WIRE 752 112 752 80
WIRE 976 112 976 80
WIRE 2224 112 2224 80
WIRE -800 128 -800 64
WIRE -752 128 -800 128
WIRE -640 128 -672 128
WIRE -512 128 -512 64
WIRE -512 128 -560 128
WIRE 2320 128 2272 128
WIRE 1536 176 1536 80
WIRE -800 192 -800 128
WIRE -512 192 -512 128
WIRE 2272 208 2272 176
WIRE 2320 208 2272 208
WIRE 208 224 208 0
WIRE 288 224 288 192
WIRE 288 224 208 224
WIRE 384 224 384 192
WIRE 384 224 288 224
WIRE 496 240 496 192
WIRE 752 240 752 176
WIRE 976 240 976 176
WIRE -80 256 -80 96
WIRE 208 256 208 224
WIRE -800 272 -800 256
WIRE -656 272 -800 272
WIRE -512 272 -512 256
WIRE -512 272 -656 272
WIRE -656 288 -656 272
WIRE -384 288 -384 160
WIRE 160 336 128 336
WIRE 1536 336 1536 256
WIRE 2224 336 2224 272
WIRE 2224 336 1536 336
WIRE -80 416 -80 320
WIRE 208 416 208 352
WIRE 336 560 304 560
WIRE 432 560 416 560
WIRE 432 656 432 560
WIRE 432 656 416 656
WIRE 480 656 432 656
WIRE 608 656 560 656
WIRE 16 672 0 672
WIRE 304 672 304 560
WIRE 304 672 96 672
WIRE 352 672 304 672
WIRE 1312 672 1312 80
WIRE -144 688 -160 688
WIRE -48 688 -64 688
WIRE 448 688 416 688
WIRE 448 704 448 688
WIRE 784 704 768 704
WIRE 896 704 864 704
WIRE -48 784 -48 688
WIRE -48 784 -64 784
WIRE 0 784 0 672
WIRE 0 784 -48 784
WIRE 896 784 896 704
WIRE 896 784 864 784
WIRE 992 784 896 784
WIRE 1136 784 1072 784
WIRE -256 800 -464 800
WIRE -160 800 -160 688
WIRE -160 800 -256 800
WIRE -128 800 -160 800
WIRE 352 800 304 800
WIRE 432 800 416 800
WIRE 608 800 608 656
WIRE 704 800 608 800
WIRE 768 800 768 704
WIRE 768 800 704 800
WIRE 800 800 768 800
WIRE 1312 800 1312 752
WIRE -528 816 -672 816
WIRE -32 816 -64 816
WIRE 896 816 864 816
WIRE 960 816 896 816
WIRE 1136 816 1136 784
WIRE 1536 816 1536 336
WIRE -432 832 -464 832
WIRE -32 832 -32 816
WIRE 896 848 896 816
WIRE 960 848 960 816
WIRE 1312 848 1312 800
WIRE 1536 848 1536 816
WIRE -432 864 -432 832
WIRE 432 896 432 800
WIRE 432 896 416 896
WIRE 480 896 432 896
WIRE 608 896 608 800
WIRE 608 896 560 896
WIRE 0 912 0 784
WIRE 16 912 0 912
WIRE 224 912 96 912
WIRE 304 912 304 800
WIRE 304 912 224 912
WIRE 352 912 304 912
WIRE 448 928 416 928
WIRE 1136 928 1136 896
WIRE 448 944 448 928
WIRE 960 944 960 928
WIRE 1312 944 1312 928
WIRE 1536 944 1536 928
WIRE 960 960 960 944
WIRE 896 1040 896 928
FLAG 496 240 0
FLAG 752 240 0
FLAG 976 240 0
FLAG 208 416 0
FLAG -80 416 0
FLAG -656 288 0
FLAG -384 288 0
FLAG 1312 944 0
FLAG 960 1040 0
FLAG -432 944 0
FLAG -672 816 pwm
IOPIN -672 816 Out
FLAG 704 800 error
FLAG -32 832 0
FLAG 448 704 0
FLAG 448 944 0
FLAG 224 912 int_out
FLAG 1472 80 out
FLAG -256 800 control
FLAG 128 416 0
FLAG 192 1072 0
FLAG 256 1072 0
FLAG 192 992 V+
FLAG 384 880 V+
FLAG 384 640 V+
FLAG 384 944 V-
FLAG 384 704 V-
FLAG 256 992 V-
FLAG -96 768 V+
FLAG -96 832 V-
FLAG 896 1040 0
FLAG -576 -48 in
FLAG 1536 944 0
FLAG 1312 800 V_fb
FLAG 1536 816 I_fb
FLAG 1136 928 0
FLAG 1728 272 0
FLAG 1728 192 VRes
FLAG -432 832 st
FLAG 960 944 ref
FLAG 1136 784 sense
SYMBOL ind2 368 96 R0
SYMATTR InstName L1
SYMATTR Value 300µ
SYMATTR Type ind
SYMBOL ind2 480 96 R0
SYMATTR InstName L2
SYMATTR Value 300µ
SYMATTR Type ind
SYMBOL ind 800 96 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName Lx
SYMATTR Value 400µ
SYMATTR SpiceLine Rser=20m
SYMBOL cap 960 112 R0
SYMATTR InstName Cx
SYMATTR Value 100µ
SYMATTR SpiceLine Rser=10m
SYMBOL res 1520 160 R0
SYMATTR InstName Rcarga
SYMATTR Value R=V(VRes)
SYMBOL nmos 160 256 R0
SYMATTR InstName M2
SYMATTR Value AOD280A60
SYMBOL diode -64 320 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D5
SYMBOL diode 224 0 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D3
SYMBOL diode 608 96 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName D1
SYMBOL diode 768 176 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMBOL nmos -128 -64 R0
SYMATTR InstName M1
SYMATTR Value AOD280A60
SYMBOL ind 272 96 R0
SYMATTR InstName L3
SYMATTR Value 5m
SYMBOL voltage -656 128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vac
SYMATTR Value SINE(0 {Vac*sqrt(2)} 50)
SYMBOL cap -400 96 R0
SYMATTR InstName C2
SYMATTR Value 50µ
SYMBOL diode -784 256 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D4
SYMBOL diode -528 256 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D6
SYMBOL diode -784 64 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D7
SYMBOL diode -528 64 M180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D8
SYMBOL res 1296 656 R0
SYMATTR InstName Rdivh
SYMATTR Value 41k
SYMBOL res 1296 832 R0
SYMATTR InstName Rdivl
SYMATTR Value 1k
SYMBOL OpAmps\\UniversalOpAmp1 832 800 M0
SYMATTR InstName U1
SYMBOL res 1088 768 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 100k
SYMBOL voltage 960 944 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V1
SYMATTR Value 1
SYMBOL res 944 832 R0
SYMATTR InstName R7
SYMATTR Value 100k
SYMBOL res 880 688 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 100k
SYMBOL OpAmps\\UniversalOpAmp2 -496 816 R180
SYMATTR InstName U7
SYMATTR Value2 Avol=1Meg GBW=100G Slew=1000G
SYMBOL voltage -432 848 R0
WINDOW 3 24 96 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR Value PULSE(0 {Vst} 0 {0.99/fsw} {0.01/fsw} 0 {1/fsw})
SYMATTR InstName V2
SYMBOL res -48 672 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 100k
SYMBOL res 576 640 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rp1
SYMATTR Value 1k
SYMBOL res 432 544 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rp2
SYMATTR Value 50k
SYMBOL res 576 880 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Ri
SYMATTR Value 500
SYMBOL cap 416 784 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName Ci
SYMATTR Value 1µ
SYMBOL res 112 896 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 100k
SYMBOL res 112 656 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R18
SYMATTR Value 100k
SYMBOL bv -160 0 M0
WINDOW 3 24 96 Invisible 2
SYMATTR Value V=if(V(pwm)>0,12,0)
SYMATTR InstName Vswh
SYMBOL OpAmps\\UniversalOpAmp2 384 672 M0
SYMATTR InstName U3
SYMBOL OpAmps\\UniversalOpAmp2 384 912 M0
SYMATTR InstName U4
SYMBOL voltage 192 976 M0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V3
SYMATTR Value {Vst/2}
SYMBOL voltage 256 1088 M180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V4
SYMATTR Value {Vst/2}
SYMBOL OpAmps\\UniversalOpAmp2 -96 800 M0
SYMATTR InstName U2
SYMBOL voltage -768 128 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 -32 56 Invisible 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName Vpert
SYMATTR Value PULSE(0 -40 3m 1n 1n 5m 20m)
SYMBOL res 912 832 M0
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res 1552 832 M0
SYMATTR InstName R_I_fb
SYMATTR Value 1
SYMBOL bv 1136 800 R0
WINDOW 3 61 -181 VRight 2
WINDOW 0 27 -61 Invisible 2
SYMATTR Value V=if(V(V_fb)>V(I_fb),V(V_fb),V(I_fb))
SYMATTR InstName V_fb
SYMBOL voltage 1728 176 R0
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName VRes
SYMATTR Value PWL file=Impedancia-10S1P.txt
SYMBOL bv 128 320 M0
WINDOW 3 24 96 Invisible 2
SYMATTR Value V=if(V(pwm)>0,12,0)
SYMATTR InstName Vswl
SYMBOL sw 2224 96 M0
SYMATTR InstName S1
SYMBOL res 2240 176 M0
SYMATTR InstName R1
SYMATTR Value 30
SYMBOL voltage 2320 224 M180
WINDOW 0 24 96 Left 2
WINDOW 3 24 16 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
SYMATTR InstName V5
SYMATTR Value PULSE(0 0 8m 1n 1n 1 2)
TEXT 392 56 Left 2 !K L1 L2 1
TEXT -880 464 Left 2 !.tran 100m
TEXT -880 488 Left 2 !.param Vac=220 fsw=125k Vsw=12 Vst=6
TEXT -128 592 Left 2 ;Sumador/Inversor
TEXT 464 568 Left 2 ;Proporcional
TEXT 456 800 Left 2 ;Integrador
TEXT -880 512 Left 2 !.ic V(int_out)=0 V(e)=0
TEXT -880 536 Left 2 !.model SW SW(Ron=1e-3 Roff=10Meg Vt=0.5)
TEXT 1760 736 Left 2 ;Valores de resistencia R_I_fb según el modo\n1A -> 1Ohm\n1.6A -> 0.625Ohm\n2.1A -> 0.48Ohm\n3.2A -> 0.31Ohm\n4.3A -> 0.23Ohm\n5A -> 0.2Ohm\n6.7A -> 0.15Ohm
TEXT -744 -208 Left 2 ;Conversion AC/DC no regulada
TEXT 168 -208 Left 2 ;Conversor Forward de doble switch (DC/DC)
TEXT 1320 560 Left 2 ;Sensado de\ntensión y corriente
TEXT 800 608 Left 2 ;Amplificador de error
TEXT 128 1120 Left 2 ;Compensación
TEXT -616 704 Left 2 ;Generador de onda PWM
RECTANGLE Normal -896 352 -272 -192 2
RECTANGLE Normal 1088 480 -256 -192 2
RECTANGLE Normal 1600 976 1248 608 2
RECTANGLE Normal 1088 1072 736 624 2
RECTANGLE Normal 672 1104 -208 496 2
RECTANGLE Normal -304 976 -656 720 2
